<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Brython </title>

</head>

<script src="brython.js"></script>
<script src="brython_stdlib.js"></script>

<body onload="brython()">
<h1><button id="b1">Coffin</button></h1>
<canvas id="zone8" width="800" height="800"></canvas>
<canvas id="zone9" width="500" height="500"></canvas>


</body>

<script type="text/python" id="script1">
from browser import document, html,console,window
import math
global x
x=0.1
global rotation
rotation=1
run = None
canvas = document["zone8"]
gl = canvas.getContext("webgl")

def matmul(mata,matb):
    rotation=[]
    for k in range(4):
        for i in range(4):
            sum=0
            for j in range(4):
                sum+=mata[j+k*4]*matb[i+j*4]
            rotation.append(sum)
    return rotation
def createShader(gl, sourceCode, type):
    shader = gl.createShader( type )
    gl.shaderSource( shader, sourceCode )
    gl.compileShader( shader )

    if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)==False):
        console.log("Not_possible")

    return shader
def para(gl,img,program):

    sizex=1377
    sizey=866
    #base
    b1x=18/sizex
    b1y=12/sizey
    b2x=368/sizex
    b2y=11/sizey
    b3x=369/sizex
    b3y=281/sizey
    b4x=21/sizex
    b4y=279/sizey

    #pyramid
    p1x,p1y=634/sizex,36/sizey
    p2x,p2y=514/sizex,288/sizey
    p3x,p3y=751/sizex,288/sizey

    #diamond

    d1x,d1y=1083/sizex,413/sizey
    d2x,d2y=1225/sizex,239/sizey
    d3x,d3y=860/sizex,23/sizey
    d4x,d4y=1083/sizex,51/sizey

    #flower
    f1x,f1y=175/sizex,410/sizey
    f2x,f2y=68/sizex,670/sizey
    f3x,f3y=294/sizex,670/sizey

    #top
    t1x,t1y=440/sizex,445/sizey
    t2x,t2y=960/sizex,456/sizey
    t3x,t3y=968/sizex,803/sizey
    t4x,t4y=445/sizex,800/sizey



    texpoints=[ #base
                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                #pyramid
                p1x,p1y,
                p2x,p2y,
                p3x,p3y,

                p1x,p1y,
                p2x,p2y,
                p3x,p3y,

                p1x,p1y,
                p2x,p2y,
                p3x,p3y,

                p1x,p1y,
                p2x,p2y,
                p3x,p3y,

                b1x,b1y,
                b2x,b2y,
                b3x,b3y,
                b4x,b4y,

                #diamond

                d1x,d1y,
                d2x,d2y,
                d3x,d3y,
                d4x,d4y,

                d1x,d1y,
                d2x,d2y,
                d3x,d3y,

                d1x,d1y,
                d2x,d2y,
                d3x,d3y,

                d1x,d1y,
                d2x,d2y,
                d3x,d3y,

                d1x,d1y,
                d2x,d2y,
                d3x,d3y,

                d2x,d2y,
                d2x,d2y,
                d3x,d3y,

                d2x,d2y,
                d2x,d2y,
                d3x,d3y,

                d2x,d2y,
                d2x,d2y,
                d3x,d3y,

                d2x,d2y,
                d2x,d2y,
                d3x,d3y,

                #flower
                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                f1x,f1y,
                f2x,f2y,
                f3x,f3y,

                #top
                t1x,t1y,
                t2x,t2y,
                t3x,t3y,
                t4x,t4y,

                 t1x,t1y,
                t2x,t2y,
                t3x,t3y,
                t4x,t4y,

                 t1x,t1y,
                t2x,t2y,
                t3x,t3y,
                t4x,t4y,

                 t1x,t1y,
                t2x,t2y,
                t3x,t3y,
                t4x,t4y,

                 t1x,t1y,
                t2x,t2y,
                t3x,t3y,
                t4x,t4y,









      ]

    texpoints=window.Float32Array.new(texpoints)

    texCoordLocation = gl.getAttribLocation(program, "aTextureCoord")
    texCoordBuffer = gl.createBuffer()
    gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer)
    gl.bufferData(gl.ARRAY_BUFFER,texpoints,gl.STATIC_DRAW)

    gl.enableVertexAttribArray(texCoordLocation)
    gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, False, 0, 0)
    texture = gl.createTexture()
    gl.bindTexture(gl.TEXTURE_2D, texture)


    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)

    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img)


def draw():

    global x,rotation
    vertex_src="""
    attribute vec3 a_pos;
    attribute vec2 aTextureCoord;

    varying highp vec2 vTextureCoord;

    uniform mat4 model;
    void main()
    {gl_Position=vec4(a_pos,1.0)*model;
     vTextureCoord = aTextureCoord;
    }
    """

    fragment_src="""
    varying highp vec2 vTextureCoord;

    uniform sampler2D uSampler;

    void main()
    {  gl_FragColor=texture2D(uSampler, vTextureCoord);

    }
    """

    vertexShader = createShader(gl,vertex_src, gl.VERTEX_SHADER)
    fragmentShader = createShader(gl,fragment_src, gl.FRAGMENT_SHADER)



    cupindices=[0,1,3,3,2,1,
                  4,5,7,7,4,6,
                   8,9,10,9,10,11,
                   12,13,14,13,14,15,
                   16,17,18,18,19,16,
                   20,21,22,22,23,20,

                    24,25,26,
                    27,28,29,
                    30,31,32,
                    33,34,35,
                    36,37,38,36,38,39,

                    40,41,42,40,42,43,
                    44,45,46,
                    47,48,49,
                    50,51,52,
                    53,54,55,

                    56,57,58,
                    59,60,61,
                    62,63,64,
                    65,66,67,

                    68,69,70,
                    71,72,73,
                    74,75,76,
                    77,78,79,
                    80,81,82,
                    83,84,85,
                    86,87,88,
                    89,90,91,

                   92,93,94,94,92,95,
                    96,97,98,98,96,99,
                   100,101,102,102,103,101,
                   104,105,106,106,105,107,
                   108,109,110,110,109,111,


    ]

    scale=0.35
    scale2=0.65

    scalecx=0.30
    scalecy=0.65
    scalecz=0.30

    scaletx=0.35
    scalety=0.65
    scaletz=0.35


    cup=[    #cuboid BASE
            -1*scalecx,-1*scalecy,0*scalecz, #0
             -1*scalecx,-0.66*scalecy,0*scalecz, #1
             0.7282*scalecx,-0.66*scalecy,0*scalecz, #2
             0.7282*scalecx,-1*scalecy,0*scalecz, #3

             0.7282*scalecx,-0.66*scalecy,0*scalecz, #2
             0.7282*scalecx,-1*scalecy,0*scalecz, #3
             0.7282*scalecx,-0.66*scalecy,-2.27180*scalecz,#4
             0.7282*scalecx,-1*scalecy,-2.27180*scalecz,#7

             0.7282*scalecx,-0.66*scalecy,-2.27180*scalecz,#4
             0.7282*scalecx,-1*scalecy,-2.27180*scalecz,#7
             -1*scalecx,-0.66*scalecy,-2.27180*scalecz,#5
             -1*scalecx,-1*scalecy,-2.27180*scalecz,#6

             -1*scalecx,-0.66*scalecy,-2.27180*scalecz,#5,
             -1*scalecx,-1*scalecy,-2.27180*scalecz,#6,
              -1*scalecx,-0.66*scalecy,0*scalecz, #1,
             -1*scalecx,-1*scalecy,0*scalecz, #0,15

              -1*scalecx,-0.66*scalecy,0*scalecz, #1
             0.7282*scalecx,-0.66*scalecy,0*scalecz, #2
             0.7282*scalecx,-0.66*scalecy,-2.27180*scalecz,#4
            -1*scalecx,-0.66*scalecy,-2.27180*scalecz,#5

             -1*scalecx,-1*scalecy,0*scalecz, #0
             0.7282*scalecx,-1*scalecy,0*scalecz, #3
              0.7282*scalecx,-1*scalecy,-2.27180*scalecz,#7
             -1*scalecx,-1*scalecy,-2.27180*scalecz,#6

                 #cuboid is done

               -0.36*scale,-0.66*scale2,-1.36*scale,  #8
               0.08819*scale,-0.66*scale2,-1.36*scale, #9
              -0.1359*scale,-0.1780*scale2,-1.1359*scale, #12sub

                0.08819*scale,-0.66*scale2,-1.36*scale, #9
                0.08819*scale,-0.66*scale2,-0.91181*scale, #10
               -0.1359*scale,-0.1780*scale2,-1.1359*scale, #12sub

                 0.08819*scale,-0.66*scale2,-0.91181*scale, #10
                -0.36*scale, -0.66*scale2,-0.91181*scale,#11
                -0.1359*scale,-0.1780*scale2,-1.1359*scale, #12sub

                -0.36*scale, -0.66*scale2,-0.91181*scale,#11
                -0.36*scale,-0.66*scale2,-1.36*scale,  #8
                -0.1359*scale,-0.1780*scale2,-1.1359*scale, #12sub

                 -0.36*scale,-0.66*scale2,-1.36*scale,  #8
                 0.08819*scale,-0.66*scale2,-1.36*scale, #9
                0.08819*scale,-0.66*scale2,-0.91181*scale, #10
                -0.36*scale, -0.66*scale2,-0.91181*scale,#11
                #Triangle complete

                #Diamond
                -0.3645*scale,-0.0069*scale2,-0.90731*scale,#13
                -0.3645*scale,-0.0069*scale2,-1.3645*scale,#14
                0.092696*scale,-0.00698*scale2,-1.3645*scale,#15
                0.092696*scale,-0.00698*scale2,-0.90731*scale,#16

                -0.1359*scale,-0.32233*scale2,-1.1359*scale,#12M
                -0.3645*scale,-0.0069*scale2,-0.90731*scale,#13
                -0.3645*scale,-0.0069*scale2,-1.3645*scale,#14

                -0.3645*scale,-0.0069*scale2,-1.3645*scale,#14
                 0.092696*scale,-0.00698*scale2,-1.3645*scale,#15
                 -0.1359*scale,-0.32233*scale2,-1.1359*scale,#12M

                 0.092696*scale,-0.00698*scale2,-1.3645*scale,#15
                 0.092696*scale,-0.00698*scale2,-0.90731*scale,#16
                 -0.1359*scale,-0.32233*scale2,-1.1359*scale,#12M

                 0.092696*scale,-0.00698*scale2,-0.90731*scale,#16
                 -0.3645*scale,-0.0069*scale2,-0.90731*scale,#13
                 -0.1359*scale,-0.32233*scale2,-1.1359*scale,#12M

                -0.1359*scale,0.308467*scale2,-1.1359*scale,#17
                 -0.3645*scale,-0.0069*scale2,-0.90731*scale,#13
                 -0.3645*scale,-0.0069*scale2,-1.3645*scale,#14

                 -0.1359*scale,0.308467*scale2,-1.1359*scale,#17
                  -0.3645*scale,-0.0069*scale2,-1.3645*scale,#14
                  0.092696*scale,-0.00698*scale2,-1.3645*scale,#15

                  -0.1359*scale,0.308467*scale2,-1.1359*scale,#17
                  0.092696*scale,-0.00698*scale2,-1.3645*scale,#15
                   0.092696*scale,-0.00698*scale2,-0.90731*scale,#16

                    -0.1359*scale,0.308467*scale2,-1.1359*scale,#17
                    0.092696*scale,-0.00698*scale2,-0.90731*scale,#16
                    -0.3645*scale,-0.0069*scale2,-0.90731*scale,#13

                    #Diamond end

                    #Flower


                    -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s
                     -0.1359*scale,0.47586*scale2,-1.7295*scale,#19
                    0.0815*scale,0.47586*scale2,-1.3261*scale,#23

                    0.45729*scale,0.47586*scale2,-1.1359*scale,#20
                    0.0815*scale,0.47586*scale2,-1.3261*scale,#23
                    -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s

                    -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s
                     -0.3261*scale,0.47586*scale2,-0.9185*scale,#22
                     -0.1359*scale,0.47586*scale2,-0.54271*scale,#21

                     -0.3261*scale,0.47586*scale2,-0.9185*scale,#22
                     -0.7291*scale, 0.47586*scale2,-1.1359*scale,#18
                      -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s

                      -0.1359*scale,0.47586*scale2,-1.1359*scale,#24
                      -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s
                      -0.7291*scale, 0.47586*scale2,-1.1359*scale,#18

                      0.45729*scale,0.47586*scale2,-1.1359*scale,#20
                      -0.1359*scale,0.47586*scale2,-1.1359*scale,#24
                      -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s

                       -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s
                         -0.1359*scale,0.47586*scale2,-1.1359*scale,#24
                         -0.1359*scale,0.47586*scale2,-1.7295*scale,#19

                           -0.1359*scale,0.12819*scale2,-1.1359*scale,#17s
                         -0.1359*scale,0.47586*scale2,-1.1359*scale,#24
                         -0.1359*scale,0.47586*scale2,-0.54271*scale,#21


                    #Flower end

                    #TOP_CONTAINER
                    -0.7291*scaletx,0.47586*scalety,-0.54271*scaletz,#25
                    -0.7291*scaletx,0.47586*scalety,-1.7295*scaletz,#26
                    0.45729*scaletx,0.47586*scalety,-1.7295*scaletz,#27
                    0.45729*scaletx,0.47586*scalety,-0.54271*scaletz,#28

                     -0.9723*scaletx,0.8614*scalety,-0.2995*scaletz,#29
                      -0.7291*scaletx,0.47586*scalety,-0.54271*scaletz,#25
                       0.45729*scaletx,0.47586*scalety,-0.54271*scaletz,#28
                       0.7005*scaletx,0.86146*scalety,-0.2995*scaletz,#32

                        -0.7291*scaletx,0.47586*scalety,-1.7291*scaletz,#26
                        0.45729*scaletx,0.47586*scalety,-1.7291*scaletz,#27
                       -0.9723*scaletx,0.8614*scalety,-1.9723*scaletz,#30
                         0.7005*scaletx,0.8614*scalety,-1.9723*scaletz,#31


                      -0.7291*scaletx,0.47586*scalety,-1.7295*scaletz,#26
                      -0.7291*scaletx,0.47586*scalety,-0.54271*scaletz,#25
                      -0.9723*scaletx,0.8614*scalety,-1.9723*scaletz,#30
                     -0.9723*scaletx,0.8614*scalety,-0.2995*scaletz,#29

                      0.45729*scaletx,0.47586*scalety,-1.7291*scaletz,#27
                      0.45729*scaletx,0.47586*scalety,-0.54271*scaletz,#28
                      0.7005*scaletx,0.8614*scalety,-1.9723*scaletz,#31
                       0.7005*scaletx,0.86146*scalety,-0.2995*scaletz,#32


             ]

    vertices = window.Float32Array.new(cup)

    indices=window.Uint16Array.new(cupindices)
    program = gl.createProgram()
    gl.attachShader(program, vertexShader)
    gl.attachShader(program, fragmentShader)
    gl.linkProgram(program)
    gl.useProgram(program)

    if (gl.getProgramParameter( program, gl.LINK_STATUS)==False ):
        console.log("hoge")
    VBO = gl.createBuffer()
    gl.bindBuffer(gl.ARRAY_BUFFER, VBO)
    gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW)


    EBO = gl.createBuffer()
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, EBO)
    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indices, gl.STATIC_DRAW)


    gl.enableVertexAttribArray(gl.getAttribLocation(program, 'a_pos'))
    gl.vertexAttribPointer(gl.getAttribLocation(program,'a_pos'),3,gl.FLOAT,False,12,0)


    img=window.Image.new()
    img.src="all.png"
    console.log(img.src)
    img.onload=para(gl,img,program)






    model=gl.getUniformLocation(program, 'model')

    gl.clearColor(0.2, 0.2, 0.2, 1.0)
    gl.enable(gl.DEPTH_TEST)
    gl.depthFunc(gl.LEQUAL)



    x+=0.01
    if(x>2*3.14):
        x=0
    console.log(x)

    rot_x2=[1,0,0,0,
            0,math.cos(x),-math.sin(x),0,
            0,math.sin(x),math.cos(x),0,
            0,0,0,1
            ]
    rot_y2=[math.cos(x),0,math.sin(x),0,
            0,1,0,0,
            -math.sin(x),0,math.cos(x),0,
            0,0,0,1]
    rot_z2=[math.cos(x),-math.sin(x),0,0,
             math.sin(x),math.cos(x),0,0,
             0,0,1,0,
             0,0,0,1
            ]

    rotation=rot_x2
    rotation=matmul(rotation,rot_z2)
    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)
    rotation=window.Float32Array.new(rotation) #replace what ever rotation you want rot_x2,rot_y2,rot_z2
    gl.uniformMatrix4fv(model,False, rotation)


    gl.drawElements(gl.TRIANGLES,len(cupindices),gl.UNSIGNED_SHORT,0)

def animloop(t):
    global run
    run = window.requestAnimationFrame(animloop)
    draw()

def change(event):
    global run
    if run is None:
        # start animation
        animloop(1)
    else:
        # stop animation
        window.cancelAnimationFrame(run)
        run = None

document["b1"].bind("click", change)
</script>




</html>